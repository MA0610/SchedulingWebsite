{% extends "base.html" %} 
{% block title %}Class Schedule{% endblock %}

{% block content %}
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Class Schedule</title>
</head>

<body>

    <!-- <div class="schedule">
        <div class="day droppable" data-day="Monday">Monday</div>
        <div class="day droppable" data-day="Tuesday">Tuesday</div>
        <div class="day droppable" data-day="Wednesday">Wednesday</div>
        <div class="day droppable" data-day="Thursday">Thursday</div>
        <div class="day droppable" data-day="Friday">Friday</div>
    </div> -->

    <div class="main-container">
        <div class="addCourse">
            <h3>New Course</h3>
            <div class="add-course">
                <label for="new-course">Name:</label>
                <input type="text" id="new-course" placeholder="Enter valid course">
            </div>
            
            <div class="day-selector">
                <label>Select Days: </label>
                <button class="day-button" data-days="MWF">MWF</button>
                <button class="day-button" data-days="TuTh">TuTh</button>
                <button class="day-button" data-days="MW">MW</button>
            </div>

            <div class="time-selector">
                <label>Start Time: </label>
                <input type="text" id="start-time" placeholder="ex. 0:00">
                <label>End Time: </label>
                <input type="text" id="end-time" placeholder="ex. 0:00">
                <button id="add-course-btn">Add Course</button>
            </div>
            
        
            <h3>Classes Available</h3>
            <div class="search-container">
                <label for="search">Search Classes:</label>
                <input type="text" id="search" placeholder="Search by class name or code...">
            </div>

            <div class="scrollable-classes" id="available-classes">
                <div class="class" draggable="true" data-class="Math 101">Math 101</div>
                <div class="class" draggable="true" data-class="History 201">History 201</div>
                <div class="class" draggable="true" data-class="Biology 305">Biology 305</div>
                <div class="class" draggable="true" data-class="Chemistry 102">Chemistry 102</div>
                <div class="class" draggable="true" data-class="Physics 401">Physics 401</div>
                <div class="class" draggable="true" data-class="Art 210">Art 210</div>
                <div class="class" draggable="true" data-class="Computer Science 101">Computer Science 101</div>
                <div class="class" draggable="true" data-class="Statistics 202">Statistics 202</div>
                <div class="class" draggable="true" data-class="Economics 301">Economics 301</div>
            </div>

            <div class="trash-bin droppable" id="trash-bin">
                Drop here to remove from schedule
            </div>
            <button id="submit-schedule-btn">Submit Schedule</button>

            <button type="button" id="clearDatabaseButton">Clear Database</button>

        </div>

    
        <div class="content">
            <div class="schedule">
                <div class="day droppable" data-day="Monday">
                    <h3>Monday</h3>
                    <div class="time-slot droppable" data-time-slot="0" data-days="8:00-9:25 am MW">8:00-9:25 am MW</div>
                    <div class="time-slot droppable" data-time-slot="1" data-days="8:00-9:25 am MF">8:00-9:25 am MF</div>
                    <div class="time-slot droppable" data-time-slot="2" data-days="8:30-9:25 am M-F">8:30-9:25 am M-F</div>
                    <div class="time-slot droppable" data-time-slot="3" data-days="8:30-9:25 am MWF">8:30-9:25 am MWF</div>
                    <div class="time-slot droppable" data-time-slot="4" data-days="9:35-10:30 am MWF" >9:35-10:30 am MWF</div>
                    <div class="time-slot droppable" data-time-slot="5" data-days="10:40-11:35 am MWF" >10:40-11:35 am MWF</div>
                    <div class="time-slot droppable" data-time-slot="6" data-days="11:45-12:40 pm MWF">11:45-12:40 pm MWF</div>
                    <div class="time-slot droppable" data-time-slot="7" data-days="1:55-2:50 pm M-F">1:55-2:50 pm M-F</div>
                    <div class="time-slot droppable" data-time-slot="8" data-days="1:55-2:50 pm MWF">1:55-2:50 pm MWF</div>
                    <div class="time-slot droppable" data-time-slot="9" data-days="1:55-2:50 pm MWF">1:55-2:50 pm MWF</div>
                    <div class="time-slot droppable" data-time-slot="10" data-days="3:00-3:55 pm MWF">3:00-3:55 pm MWF</div>
                    <div class="time-slot droppable" data-time-slot="11" data-days="3:00-5:55 pm M-LAB">3:00-5:55 pm M-LAB</div>
                    <div class="time-slot droppable" data-time-slot="12" data-days="4:05-5:00 pm MWF">4:05-5:00 pm MWF</div>
                    <div class="time-slot droppable" data-time-slot="13" data-days="4:05-5:30 pm MW">4:05-5:30 pm MW</div>
                    <div class="time-slot droppable" data-time-slot="14" data-days="4:05-5:30 pm MF">4:05-5:30 pm MF</div>
                    <div class="time-slot droppable" data-time-slot="15" data-days="5:40-7:05 pm MW">5:40-7:05 pm MW</div>
                    <div class="time-slot droppable" data-time-slot="16" data-days="7:15-8:40 pm MW">7:15-8:40 pm MW</div>
                    <div class="time-slot droppable" data-time-slot="17" data-days="7:15-10:10 pm M-LAB">7:15-10:10 pm M-LAB</div>
                    <div class="time-slot droppable" data-time-slot="18" data-days="8:50-10:15 pm MW">8:50-10:15 pm MW</div>
                </div>
                <div class="day droppable" data-day="Tuesday">
                    <h3>Tuesday</h3>
                    <div class="time-slot droppable" data-time-slot="0" data-days="8:30-9:25 am M-F">8:30-9:25 am M-F</div>
                    <div class="time-slot droppable" data-time-slot="1" data-days="8:30-9:55 am TR">8:30-9:55 am TR</div>
                    <div class="time-slot droppable" data-time-slot="2" data-days="8:30-11:25 am T">8:30-11:25 am T</div>
                    <div class="time-slot droppable" data-time-slot="3" data-days="8:30-11:25 am T-LAB">8:30-11:25 am T-LAB</div>
                    <div class="time-slot droppable" data-time-slot="4" data-days="10:05-11:30 am TR">10:05-11:30 am TR</div>
                    <div class="time-slot droppable" data-time-slot="5" data-days="1:30-2:55 pm TR">1:30-2:55 pm TR</div>
                    <div class="time-slot droppable" data-time-slot="6" data-days="1:30-4:25 pm T">1:30-4:25 pm T</div>
                    <div class="time-slot droppable" data-time-slot="7" data-days="1:30-4:25 pm T-LAB">1:30-4:25 pm T-LAB</div>
                    <div class="time-slot droppable" data-time-slot="8" data-days="1:55-2:50 pm M-F">1:55-2:50 pm M-F</div>
                    <div class="time-slot droppable" data-time-slot="9" data-days="3:05-4:30 pm TR">3:05-4:30 pm TR</div>
                    <div class="time-slot droppable" data-time-slot="10" data-days="5:00-6:25 pm TR">5:00-6:25 pm TR</div>
                    <div class="time-slot droppable" data-time-slot="11" data-days="7:15-10:15 pm T">7:15-10:15 pm T</div>
                </div>
                <div class="day droppable" data-day="Wednesday">
                    <h3>Wednesday</h3>
                    <div class="time-slot droppable" data-time-slot="0" data-days="8:00-9:25 am MW">8:00-9:25 am MW</div>
                    <div class="time-slot droppable" data-time-slot="1" data-days="8:30-9:25 am M-F">8:30-9:25 am M-F</div>
                    <div class="time-slot droppable" data-time-slot="2" data-days="8:30-9:25 am MWF">8:30-9:25 am MWF</div>
                    <div class="time-slot droppable" data-time-slot="3" data-days="9:35-10:30 am MWF">9:35-10:30 am MWF</div>
                    <div class="time-slot droppable" data-time-slot="4" data-days="10:40-11:35 am MWF">10:40-11:35 am MWF</div>
                    <div class="time-slot droppable" data-time-slot="5" data-days="11:45-12:40 pm MWF">11:45-12:40 pm MWF</div>
                    <div class="time-slot droppable" data-time-slot="6" data-days="1:55-2:50 pm M-F">1:55-2:50 pm M-F</div>
                    <div class="time-slot droppable" data-time-slot="7" data-days="1:55-2:50 pm MWF">1:55-2:50 pm MWF</div>
                    <div class="time-slot droppable" data-time-slot="8" data-days="1:55-2:50 pm MWF">1:55-2:50 pm MWF</div>
                    <div class="time-slot droppable" data-time-slot="9" data-days="1:55-4:50 pm W-LAB">1:55-4:50 pm W-LAB</div>
                    <div class="time-slot droppable" data-time-slot="10" data-days="3:00-3:55 pm MWF">3:00-3:55 pm MWF</div>
                    <div class="time-slot droppable" data-time-slot="11" data-days="3:00-5:55 pm W-LAB">3:00-5:55 pm W-LAB</div>
                    <div class="time-slot droppable" data-time-slot="12" data-days="4:05-5:00 pm MWF">4:05-5:00 pm MWF</div>
                    <div class="time-slot droppable" data-time-slot="13" data-days="4:05-5:30 pm MW">4:05-5:30 pm MW</div>
                    <div class="time-slot droppable" data-time-slot="14" data-days="5:40-7:05 pm MW">5:40-7:05 pm MW</div>
                    <div class="time-slot droppable" data-time-slot="15" data-days="7:15-8:40 pm MW">7:15-8:40 pm MW</div>
                    <div class="time-slot droppable" data-time-slot="16" data-days="7:15-10:10 pm W-LAB">7:15-10:10 pm W-LAB</div>
                    <div class="time-slot droppable" data-time-slot="17" data-days="7:15-10:15 pm W">7:15-10:15 pm W</div>
                    <div class="time-slot droppable" data-time-slot="18" data-days="8:50-10:15 pm MW">8:50-10:15 pm MW</div>
                </div>
                <div class="day droppable" data-day="Thursday">
                    <h3>Thursday</h3>
                    <div class="time-slot droppable" data-time-slot="0" data-days="8:30-9:25 am M-F">8:30-9:25 am M-F</div>
                    <div class="time-slot droppable" data-time-slot="1" data-days="8:30-9:55 am TR">8:30-9:55 am TR</div>
                    <div class="time-slot droppable" data-time-slot="2" data-days="8:30-11:25 am R">8:30-11:25 am R</div>
                    <div class="time-slot droppable" data-time-slot="3" data-days="8:30-11:25 am R-LAB">8:30-11:25 am R-LAB</div>
                    <div class="time-slot droppable" data-time-slot="4" data-days="10:05-11:30 am TR">10:05-11:30 am TR</div>
                    <div class="time-slot droppable" data-time-slot="5" data-days="1:30-2:55 pm TR">1:30-2:55 pm TR</div>
                    <div class="time-slot droppable" data-time-slot="6" data-days="1:30-4:25 pm R">1:30-4:25 pm R</div>
                    <div class="time-slot droppable" data-time-slot="7" data-days="1:30-4:25 pm R-LAB">1:30-4:25 pm R-LAB</div>
                    <div class="time-slot droppable" data-time-slot="8" data-days="1:55-2:50 pm M-F">1:55-2:50 pm M-F</div>
                    <div class="time-slot droppable" data-time-slot="9" data-days="3:05-4:30 pm TR">3:05-4:30 pm TR</div>
                    <div class="time-slot droppable" data-time-slot="10" data-days="5:00-6:25 pm TR">5:00-6:25 pm TR</div>
                    <div class="time-slot droppable" data-time-slot="11" data-days="7:15-10:10 pm R-LAB">7:15-10:10 pm R-LAB</div>
                    <div class="time-slot droppable" data-time-slot="12" data-days="7:15-10:15 pm R">7:15-10:15 pm R</div>
                </div>
                <div class="day droppable" data-day="Friday">
                    <h3>Friday</h3>
                    <div class="time-slot droppable" data-time-slot="0" data-days="8:00-9:25 am MF">8:00-9:25 am MF</div>
                    <div class="time-slot droppable" data-time-slot="1" data-days="8:30-9:25 am M-F">8:30-9:25 am M-F</div>
                    <div class="time-slot droppable" data-time-slot="2" data-days="8:30-9:25 am MWF">8:30-9:25 am MWF</div>
                    <div class="time-slot droppable" data-time-slot="3" data-days="9:35-10:30 am MWF">9:35-10:30 am MWF</div>
                    <div class="time-slot droppable" data-time-slot="4" data-days="10:40-11:35 am MWF">10:40-11:35 am MWF</div>
                    <div class="time-slot droppable" data-time-slot="5" data-days="11:45-12:40 pm MWF">11:45-12:40 pm MWF</div>
                    <div class="time-slot droppable" data-time-slot="6" data-days="1:55-2:50 pm M-F">1:55-2:50 pm M-F</div>
                    <div class="time-slot droppable" data-time-slot="7" data-days="1:55-2:50 pm MWF">1:55-2:50 pm MWF</div>
                    <div class="time-slot droppable" data-time-slot="8" data-days="1:55-2:50 pm MWF">1:55-2:50 pm MWF</div>
                    <div class="time-slot droppable" data-time-slot="9" data-days="3:00-3:55 pm MWF">3:00-3:55 pm MWF</div>
                    <div class="time-slot droppable" data-time-slot="10" data-days="3:00-5:55 pm F-LAB">3:00-5:55 pm F-LAB</div>
                    <div class="time-slot droppable" data-time-slot="11" data-days="4:05-5:00 pm MWF">4:05-5:00 pm MWF</div>
                    <div class="time-slot droppable" data-time-slot="12" data-days="4:05-5:30 pm MF">4:05-5:30 pm MF</div>
                    <div class="time-slot droppable" data-time-slot="13" data-days="7:15-10:10 pm F-LAB">7:15-10:10 pm F-LAB</div>
                </div>
            </div>
        </div>
    </div>
    

    <script>
        document.getElementById('add-course-btn').addEventListener('click', () => {
        const courseName = document.getElementById('new-course').value;
        const startTime = document.getElementById('start-time').value;
        const endTime = document.getElementById('end-time').value;
        const selectedDays = Array.from(document.querySelectorAll('.day-button.selected'))
                                .map(button => button.dataset.days)
                                .join(', ');

        if (!courseName || !startTime || !endTime || !selectedDays) {
            alert('Please fill in all fields.');
            return;
        }

        const newClass = document.createElement('div');
        newClass.classList.add('class');
        newClass.setAttribute('draggable', 'true');
        newClass.setAttribute('data-class', courseName);
        newClass.setAttribute('data-days', selectedDays);
        newClass.setAttribute('data-start-time', startTime);
        newClass.setAttribute('data-end-time', endTime);

        newClass.textContent = `${courseName} (${selectedDays} ${startTime} - ${endTime})`;
        
        newClass.addEventListener('dragstart', () => newClass.classList.add('dragging'));
        newClass.addEventListener('dragend', () => newClass.classList.remove('dragging'));

        document.getElementById('available-classes').appendChild(newClass);

        // Clear the form inputs
        document.getElementById('new-course').value = '';
        document.getElementById('start-time').value = '';
        document.getElementById('end-time').value = '';
        document.querySelectorAll('.day-button').forEach(btn => btn.classList.remove('selected'));
    });

    // Add functionality to select day buttons
    document.querySelectorAll('.day-button').forEach(button => {
        button.addEventListener('click', () => {
            button.classList.toggle('selected');
        });
    });


    //indentation should begin here for this block    
        // const draggables = document.querySelectorAll('.class');
        // const droppables = document.querySelectorAll('.droppable');
        const trashBin = document.getElementById('trash-bin');
        const availableClassesContainer = document.getElementById('available-classes');
        
        const draggables = document.querySelectorAll('.class');
        const droppableTimeSlots = document.querySelectorAll('.time-slot');

        // Define a mapping of day sets to their corresponding days
        const daySetMapping = {
            'MF': ['Monday', 'Friday'],
            'MW': ['Monday', 'Wednesday'],
            'MWF': ['Monday', 'Wednesday', 'Friday'],
            'M-F': ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'],
            'TR': ['Tuesday', 'Thursday']
        };

        // Dragging functionality
        draggables.forEach(draggable => {
            draggable.addEventListener('dragstart', () => {
                draggable.classList.add('dragging');
            });

            draggable.addEventListener('dragend', () => {
                draggable.classList.remove('dragging');
            });
        });


        // Function to show the notification
        function showNotification(message) {
            console.log('Notification Triggered');  // Check if function is called
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.innerText = message;
            document.body.appendChild(notification);
            console.log('Notification Appended');  // Check if notification is appended

            // Automatically remove the notification after 3 seconds
            setTimeout(() => {
                console.log('Notification Removed');  // Check if removal is working
                notification.remove();
            }, 3000);
        }


        droppableTimeSlots.forEach(timeSlot => {
            timeSlot.addEventListener('dragover', (e) => {
                e.preventDefault();
            });

            timeSlot.addEventListener('drop', (e) => {
                e.preventDefault();
                const draggingElement = document.querySelector('.dragging');
                if (draggingElement) {
                   
                    timeSlot.appendChild(draggingElement);
                }
            });
        });

        
        // Trash bin functionality

        // Add dragover and drop event listeners to make the trash bin interactive
        trashBin.addEventListener('dragover', (e) => {
            e.preventDefault();
            trashBin.classList.add('dragging-over'); // Add visual highlight during dragover
        });

        trashBin.addEventListener('dragleave', () => {
            trashBin.classList.remove('dragging-over'); // Remove highlight when leaving
        });

        trashBin.addEventListener('drop', () => {
            const draggingElement = document.querySelector('.dragging');
            if (draggingElement) {
                // Remove the element from the frontend only
                draggingElement.remove();

                // Add drop animation and then remove it after animation ends
                trashBin.classList.add('drop-animation');
                setTimeout(() => trashBin.classList.remove('drop-animation'), 300);

                console.log("Class removed from frontend only.");
            }
            trashBin.classList.remove('dragging-over'); // Ensure highlight is removed
        });

        
const clearDatabaseButton = document.getElementById('clearDatabaseButton');

clearDatabaseButton.addEventListener('click', () => {
    if (confirm('Are you sure you want to clear the database?')) {
        fetch('/clear_database', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('Database cleared successfully!');
            } else {
                alert('Error clearing database: ' + data.message);
            }
        })
        .catch((error) => {
            console.error('Error:', error);
            alert('An error occurred while trying to clear the database.');
        });
    }
});









        // Search functionality
        const searchInput = document.getElementById('search');
        const availableClasses = document.querySelectorAll('.class');

        searchInput.addEventListener('input', function() {
            const searchText = searchInput.value.toLowerCase();
            availableClasses.forEach(classElement => {
                const className = classElement.getAttribute('data-class').toLowerCase();
                classElement.style.display = className.includes(searchText) ? 'block' : 'none';
            });
        });


    //need to include javascript for submition btn. 
       // Submit schedule functionality
    // Submit schedule functionality
    const submitButton = document.getElementById('submit-schedule-btn'); // Make sure to use the correct ID

    submitButton.addEventListener('click', () => {
        const newScheduleData = Array.from({ length: 5 }, () => Array(20).fill(null)); // 5 days, 20 time slots
        const days = document.querySelectorAll('.day');

        // Collect data for each day
        days.forEach(day => {
            const dayIndex = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday"].indexOf(day.getAttribute('data-day'));
            const timeSlots = day.querySelectorAll('.time-slot');

            timeSlots.forEach((slot, index) => {
                const classElement = slot.querySelector('.class');

                if (classElement) {
                    if (!newScheduleData[dayIndex][index]) {
                        newScheduleData[dayIndex][index] = [];
                    }
                    newScheduleData[dayIndex][index].push(classElement.getAttribute('data-class'));
                }
            });
        });

        // Collect the day-set value from the first day (or decide how you want to handle this)
        const firstDaySlot = days[0].querySelector('.time-slot');
        const daySetValue = firstDaySlot ? firstDaySlot.getAttribute('day-set') : null;

        // Make the fetch request after collecting all data
        fetch('/schedule', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ schedule: newScheduleData, set: daySetValue })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('Schedule submitted successfully!'); // Show notification once
            } else {
                alert('Error submitting schedule: ' + data.message);
            }
        })
        .catch((error) => {
            console.error('Error:', error);
        });
    });

    </script>
</body>

{% endblock %}
